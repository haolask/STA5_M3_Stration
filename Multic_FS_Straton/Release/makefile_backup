NAME = Multic-FS_Straton
#if @ is before a following commande $(..), call options (comments) are masked

CC = "C:/RENESAS/KPIT/GNUARM-RZv13.01-EABI/arm-rz-eabi/arm-rz-eabi/bin/arm-rz-eabi-gcc.exe"
AS = "C:/RENESAS/KPIT/GNUARM-RZv13.01-EABI/arm-rz-eabi/arm-rz-eabi/bin/arm-rz-eabi-as.exe"
LD = "C:/RENESAS/KPIT/GNUARM-RZv13.01-EABI/arm-rz-eabi/arm-rz-eabi/bin/arm-rz-eabi-ld.exe"
LIBGEN = "C:/RENESAS/KPIT/GNUARM-RZv13.01-EABI/arm-rz-eabi/arm-rz-eabi/bin/arm-rz-eabi-libgen.exe"
OBJCOPY = "C:/RENESAS/KPIT/GNUARM-RZv13.01-EABI/arm-rz-eabi/arm-rz-eabi/bin/arm-rz-eabi-objcopy.exe"
MKD = "C:/RENESAS/yagarto-tools-20121018/bin/mkdir.exe"
SRECORD = "C:/RENESAS/Tools/srecord/srec_cat.exe"

C_DEFINES =

S_DEFINES =

LIBS = 
#-I"D:/KPIT/GNUARM-RZv13.01-EABI/arm-rz-eabi/arm-rz-eabi/arm-rz-eabi/lib"\
#-I"D:/KPIT/GNUARM-RZv13.01-EABI/arm-rz-eabi/arm-rz-eabi/lib/gcc/arm-rz-eabi/4.7-GNUARM-RZ_v13.01"

SOURCE_DIR = ..
BUILD_DIR = ../Release

C_OPTS =	-c \
			-I. \
			-I"C:/RENESAS/KPIT/GNUARM-RZv13.01-EABI/arm-rz-eabi/arm-rz-eabi/arm-rz-eabi/include" \
			-I"C:/RENESAS/KPIT/GNUARM-RZv13.01-EABI/arm-rz-eabi/arm-rz-eabi/bin/newlib/libc/sys/arm" \
			-I"$(SOURCE_DIR)/Include" \
			-I"$(SOURCE_DIR)/Include/FreeRTOS" \
			-I"$(SOURCE_DIR)/Sources/API" \
			-I"$(SOURCE_DIR)/Sources/APP/CORE/VM/custom" \
			-I"$(SOURCE_DIR)/Sources/APP/CORE/VM/standard" \
			-I"$(SOURCE_DIR)/Sources/APP/CORE/base" \
			-I"$(SOURCE_DIR)/Sources/APP/COM/J1939" \
			-I"$(SOURCE_DIR)/Sources/APP/BLOCKS/Dtc" \
			-I"$(SOURCE_DIR)/Sources/APP/BLOCKS/J1939" \
			-I"$(SOURCE_DIR)/Sources/APP/BLOCKS/Lin" \
			-I"$(SOURCE_DIR)/Sources/APP/BLOCKS/Param" \
			-I"$(SOURCE_DIR)/Sources/APP/BLOCKS/RTC" \
			-I"$(SOURCE_DIR)/Sources/APP/BLOCKS/Sleep" \
			-I"$(SOURCE_DIR)/Sources/APP/BLOCKS/SpecifCalib" \
			-std=c99 \
			-fmessage-length=0 \
			-mcpu=cortex-a9 \
			-mlittle-endian \
			-marm \
			-mthumb-interwork \
			-mno-unaligned-access \
			-mfpu=vfpv3 \
			-mfloat-abi=hard \
			-Wall \
			-Wconversion \
			-v \
			-Os \
			-fPIC

S_OPTS =	-EL \
			-mcpu=cortex-a9 \
			-mlittle-endian \
			-mthumb-interwork \
			-mfloat-abi=hard \
			-mfpu=vfpv3 
				
C_FILES =	Sources/APP/CORE/VM/custom/T5ACTIA.c \
			Sources/APP/CORE/VM/custom/t5can.c \
			Sources/APP/CORE/VM/custom/t5ddkcip.c \
			Sources/APP/CORE/VM/custom/t5flash.c \
			Sources/APP/CORE/VM/custom/t5ios.c \
			Sources/APP/CORE/VM/custom/t5memory.c \
			Sources/APP/CORE/VM/custom/t5retain.c \
			Sources/APP/CORE/VM/custom/t5rtclk.c \
			Sources/APP/CORE/VM/custom/t5serial.c \
			Sources/APP/CORE/VM/custom/t5socket.c \
			Sources/APP/CORE/VM/standard/t5cs.c \
			Sources/APP/CORE/VM/standard/t5csser.c \
			Sources/APP/CORE/VM/standard/t5cssock.c \
			Sources/APP/CORE/VM/standard/t5def.c \
			Sources/APP/CORE/VM/standard/t5heap.c \
			Sources/APP/CORE/VM/standard/t5mbfb.c \
			Sources/APP/CORE/VM/standard/t5mm.c \
			Sources/APP/CORE/VM/standard/t5tools.c \
			Sources/APP/CORE/VM/standard/t5vfs.c \
			Sources/APP/CORE/VM/standard/t5vm.c \
			Sources/APP/CORE/VM/standard/t5vmbsmp.c \
			Sources/APP/CORE/VM/standard/t5vmcan.c \
			Sources/APP/CORE/VM/standard/t5vmcnv.c \
			Sources/APP/CORE/VM/standard/t5vmcode.c \
			Sources/APP/CORE/VM/standard/t5vmfbl.c \
			Sources/APP/CORE/VM/standard/t5vmiox.c \
			Sources/APP/CORE/VM/standard/t5vmlog.c \
			Sources/APP/CORE/VM/standard/t5vmmap.c \
			Sources/APP/CORE/VM/standard/t5vmprg.c \
			Sources/APP/CORE/VM/standard/t5vmrsc.c \
			Sources/APP/CORE/VM/standard/t5vmsrv.c \
			Sources/APP/CORE/VM/standard/t5vmstf.c \
			Sources/APP/CORE/VM/standard/t5vmstfb.c \
			Sources/APP/CORE/VM/standard/t5vmstr.c \
			Sources/APP/CORE/VM/standard/t5vmtic.c \
			Sources/APP/CORE/VM/standard/t5vmtmr.c \
			Sources/APP/CORE/VM/standard/t5vmwarm.c \
			Sources/APP/COM/DIAG/CustomDiag.c \
			Sources/APP/COM/J1939/T5_J1939.c \
			Sources/APP/BLOCKS/Dtc/Dtc_Clr.c \
			Sources/APP/BLOCKS/Dtc/Dtc_List.c \
			Sources/APP/BLOCKS/Dtc/Dtc_Rd.c \
			Sources/APP/BLOCKS/Dtc/Dtc_Wr.c \
			Sources/APP/BLOCKS/J1939/FB_J1939_Status.c \
			Sources/APP/BLOCKS/LIN/Lin_Init.c \
			Sources/APP/BLOCKS/LIN/Lin_RdData.c \
			Sources/APP/BLOCKS/LIN/Lin_RqFrame.c \
			Sources/APP/BLOCKS/LIN/Lin_Tx.c \
			Sources/APP/BLOCKS/Param/Param_Rd.c \
			Sources/APP/BLOCKS/Param/Param_Wr.c \
			Sources/APP/BLOCKS/Sleep/SleepCmd.c \
			Sources/APP/BLOCKS/RTC/Rtc_Rd.c \
			Sources/APP/BLOCKS/RTC/Rtc_Wr.c \
			Sources/APP/BLOCKS/SpecifCalib/SpecifCalib_Rd.c \
			Sources/APP/BLOCKS/SpecifCalib/SpecifCalib_Wr.c \
			Sources/APP/BLOCKS/RTC/Rtc_Timer_Rd.c \
			Sources/APP/BLOCKS/RTC/Rtc_Timer_Wr.c \
			Sources/APP/BLOCKS/RTC/Rtc_Timer_Clr.c \
			Sources/APP/BLOCKS/RTC/Rtc_Alarm_Rd.c \
			Sources/APP/BLOCKS/RTC/Rtc_Alarm_Wr.c \
			Sources/APP/BLOCKS/RTC/Rtc_Alarm_Clr.c \
			Sources/APP/BLOCKS/t5blocks.c \
			Sources/APP/API_WRAPPER/api_wrapper.c \
			Sources/APP/API_WRAPPER/version.c
#			Sources/APP/CORE/VM/custom/ddkactia.c \
#			Sources/APP/CORE/VM/custom/t5ddkc.c \
#			Sources/APP/CORE/VM/standard/t5barray.c \
#			Sources/APP/CORE/VM/standard/t5csm5.c \
#			Sources/APP/CORE/VM/standard/t5ea.c \
#			Sources/APP/CORE/VM/standard/t5evs.c \
#			Sources/APP/CORE/VM/standard/t5evsfrm.c \
#			Sources/APP/CORE/VM/standard/t5evsq.c \
#			Sources/APP/CORE/VM/standard/t5mb.c \
#			Sources/APP/CORE/VM/standard/t5mbcomm.c \
#			Sources/APP/CORE/VM/standard/t5mbfram.c \
#			Sources/APP/CORE/VM/standard/t5mbsrv.c \
#			Sources/APP/CORE/VM/standard/t5rc.c \
#			Sources/APP/CORE/VM/standard/t5redcli.c \
#			Sources/APP/CORE/VM/standard/t5redsrv.c \
#			Sources/APP/CORE/VM/standard/t5reduti.c \
#			Sources/APP/CORE/VM/standard/t5reg.c \
#			Sources/APP/CORE/VM/standard/t5regapi.c \
#			Sources/APP/CORE/VM/standard/t5reghcl.c \
#			Sources/APP/CORE/VM/standard/t5reghcv.c \
#			Sources/APP/CORE/VM/standard/t5sp5dlm.c \
#			Sources/APP/CORE/VM/standard/t5sp5dls.c \
#			Sources/APP/CORE/VM/standard/t5sp5fl.c \
#			Sources/APP/CORE/VM/standard/t5sp5ftm.c \
#			Sources/APP/CORE/VM/standard/t5sp5fts.c \
#			Sources/APP/CORE/VM/standard/t5sp5tlm.c \
#			Sources/APP/CORE/VM/standard/t5sp5tls.c \
#			Sources/APP/CORE/VM/standard/t5txb.c \
#			Sources/APP/CORE/VM/standard/t5vmasi.c \
#			Sources/APP/CORE/VM/standard/t5vmclon.c \
#			Sources/APP/CORE/VM/standard/t5vmhot.c \
#			Sources/APP/CORE/VM/standard/t5vmsyb.c \
#			Sources/APP/CORE/VM/standard/t5vmtic2.c \
#			Sources/APP/CORE/VM/standard/t5xml.c \
#			Sources/APP/CORE/VM/standard/t5xmlprs.c \
#			Sources/APP/CORE/VM/standard/t5xmltag.c \
#			Sources/APP/CORE/VM/standard/t5xmlwr.c \
#			Sources/APP/CORE/VM/standard/t5xs.c \

S_FILES =	Sources/APP/CORE/base/compiler_specific/asm/initsct.S

C_OBJS = $(C_FILES:%.c=$(BUILD_DIR)/%.o)

S_OBJS = $(S_FILES:%.S=$(BUILD_DIR)/%.o)

ALL_CFLAGS = $(C_OPTS) $(C_DEFINES)
ALL_SFLAGS = $(S_OPTS) $(S_DEFINES)

LIB_OPTS = --select-lib=newlib \
--header-files=all \
--compiler-options=-mcpu=cortex-a9,-march=armv7-a,-mlittle-endian,-mthumb-interwork,-mfloat-abi=hard,-mno-unaligned-access,-mfpu=vfpv3,-Os,-ffunction-sections,-fdata-sections,-fnofunction-cse,-fomit-frame-pointer,-funit-at-a-time,-falign-jumps \
--assembler-options=-mcpu=cortex-a9,-march=armv7-a,-mlittle-endian,-mfloat-abi=hard,-mfpu=vfpv3

ALL_LIBFLAGS = $(LIB_OPTS) $(LIB_DEFINES)

#ALL_LDFLAGS = $(LD_FLAGS) \
#			-Wl,-T"Settings/GNU_DS-5-QSPI.ld" \
#			-mcpu=cortex-a9 \
#			-g3 \
#			-gdwarf-2
ALL_LDFLAGS = -estart \
			 -EL \
			 -M=$(NAME).map \
			 -q \
 			 -L"$(SOURCE_DIR)/Include" \
			 -T"$(SOURCE_DIR)/Settings/GNU_DS-5-QSPI.ld" \
 			 --verbose \
 			 --strip-debug \
 			 -L"C:\Renesas\KPIT\GNUARM-RZv13.01-EABI\arm-rz-eabi\arm-rz-eabi\lib\gcc\arm-rz-eabi\4.7-GNUARM-RZ_v13.01\fpu" \
 			 -L"$(SOURCE_DIR)/Lib" \
 			 -L"$(BUILD_DIR)" \
 			 --warn-common \
 			 --warn-unresolved-symbols \
 			 --error-unresolved-symbols \
 			 --start-group \
 			 -l$(NAME) \
 			 -lgcc \
 			 --end-group

#AUTODEPENDENCY_CFLAGS = -MMD -MF$(@:.o=.d) -MT$@


all: $(NAME).mot $(NAME).bin

clean:
#	echo "path=$(PATH)"
	rm -rf $(BUILD_DIR)/Sources $(NAME).elf $(NAME).x $(NAME).map $(NAME).mot $(NAME).mhx $(NAME).bin

$(NAME).bin: $(NAME).x
#	$(SRECORD) -VERSion
	$(SRECORD) -Disable_Sequence_Warnings \
	$(NAME).mot -crop 0x18280000 0x1843FFF7 -fill 0xFF 0x18280000 0x1843FFF8 \
	-fill 0x00 0x1843FFF8 0x1843FFFB -fill 0x03 0x1843FFFB 0x1843FFFC \
	-Checksum_Positive_Little_Endian 0x1843FFFC 4 4 \
	-offset - 0x18280000 \
	-output $(NAME).bin -binary

$(NAME).mot: $(NAME).x
	$(OBJCOPY) -O srec $(NAME).x $(NAME).mot

$(NAME).mhx: $(NAME).x
#	$(SRECORD) -VERSion
	$(SRECORD) -Disable_Sequence_Warnings \
	$(NAME).bin -binary -offset 0x18280000 \
	-output $(NAME).mhx -Motorola -address-length=4 -line-length=270 -header='P1xxxxx-(Generated-by-ACTIA)' -disable=data-count -Execution_Start_Address 0x18280000 -crlf

$(NAME).x: $(C_OBJS) $(S_OBJS) lib$(NAME).a
	$(LD) -o $@ $^ $(LIBS) $(ALL_LDFLAGS)

lib$(NAME).a:
	$(LIBGEN) $(ALL_LIBFLAGS) -o lib$(NAME).a

.SUFFIXES: .o .c

$(BUILD_DIR)/%.o: $(SOURCE_DIR)/%.c
	$(MKD) -p $(dir $@)
	$(CC) $(ALL_CFLAGS)  -c $< -o $@

$(BUILD_DIR)/%.o: $(SOURCE_DIR)/%.S
	$(MKD) -p $(dir $@)
	$(AS) $(ALL_SFLAGS)  -c $< -o $@

-include $(C_OBJS:.o=.d)
